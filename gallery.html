<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Memories üíô</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(180deg, #cfe9ff, #eef6ff);
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* FRAME */
.phone-frame {
  width: 100%;
  max-width: 420px;
  height: 100vh;
  max-height: 820px;
  position: relative;
  overflow: hidden;
}

/* PROGRESS BAR (FIXED & INDEPENDENT) */
.progress {
  position: absolute;
  top: 14px;
  left: 12px;
  right: 12px;
  display: flex;
  gap: 6px;
  z-index: 50;
  pointer-events: none;
}

.bar {
  flex: 1;
  height: 4px;
  border-radius: 4px;
  background: rgba(255,255,255,0.35);
  overflow: hidden;
}

.bar.active::after {
  content: '';
  display: block;
  height: 100%;
  width: 100%;
  background: #7399d2;
  animation: fill 3.5s linear;
}

/* SLIDER */
.story-container {
  display: flex;
  height: 100%;
  transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);
  will-change: transform;
}

.story {
  min-width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.photo-box {
  width: 92%;
  height: 78%;
  margin-bottom: 90px;
  border-radius: 22px;
  overflow: hidden;
  box-shadow: 0 25px 45px rgba(0,0,0,0.18);
  background: #000;
}

.photo-box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ENDING */
.ending {
  background: #eef6ff;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 10vh 8vw;
}

.ending h2 {
  font-weight: 500;
  margin-bottom: 12px;
  color: #3b5f94;
}

.ending p {
  font-size: 0.95rem;
  opacity: 0.85;
  color: #3b5f94;
}

@keyframes fill {
  from { width: 0; }
  to { width: 100%; }
}
</style>
</head>

<body>

<audio id="bgm" src="assets/music.mp3" loop></audio>

<div class="phone-frame">

  <div class="progress" id="progress"></div>

  <div class="story-container" id="slider">
    <div class="story"><div class="photo-box"><img src="img/photo1.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo2.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo3.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo4.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo5.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo6.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo7.jpg"></div></div>
    <div class="story"><div class="photo-box"><img src="img/photo8.jpg"></div></div>

    <div class="story">
      <div class="photo-box ending">
        <h2>Thank you for the memories ü§ç</h2>
        <p>Some moments stay quietly, but forever.</p>
      </div>
    </div>
  </div>
</div>

<script>
const slider = document.getElementById('slider');
const stories = document.querySelectorAll('.story');
const progress = document.getElementById('progress');
const audio = document.getElementById('bgm');

let index = 0;
let startX = 0;
let isHolding = false;
let audioStarted = false;

// create progress bars
stories.forEach(() => {
  const bar = document.createElement('div');
  bar.className = 'bar';
  progress.appendChild(bar);
});

function updateSlide() {
  slider.style.transform = `translateX(-${index * 100}%)`;

  document.querySelectorAll('.bar').forEach((bar, i) => {
    bar.classList.toggle('active', i === index);
  });

  // music control
  if (index === stories.length - 1) {
    fadeOut();
  } else {
    fadeIn();
  }
}

function fadeOut() {
  let v = audio.volume;
  const t = setInterval(() => {
    if (v > 0.05) {
      v -= 0.05;
      audio.volume = v;
    } else {
      audio.pause();
      clearInterval(t);
    }
  }, 100);
}

function fadeIn() {
  if (!audioStarted) return;
  audio.play().catch(() => {});
  let v = audio.volume;
  const t = setInterval(() => {
    if (v < 1) {
      v += 0.05;
      audio.volume = v;
    } else clearInterval(t);
  }, 100);
}

// autoplay
setInterval(() => {
  if (!isHolding && index < stories.length - 1) {
    index++;
    updateSlide();
  }
}, 3500);

// swipe
document.addEventListener('touchstart', e => {
  startX = e.touches[0].clientX;
  isHolding = true;

  if (!audioStarted) {
    audio.play().catch(() => {});
    audioStarted = true;
  }
});

document.addEventListener('touchend', e => {
  isHolding = false;
  const diff = startX - e.changedTouches[0].clientX;

  if (diff > 50 && index < stories.length - 1) index++;
  if (diff < -50 && index > 0) index--;

  updateSlide();
});
</script>

</body>
</html>
